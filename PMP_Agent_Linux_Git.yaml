- name: Install UEMS Linux Agent
  hosts: all
  vars:
    repo_url: "https://github.com/askerchanASL/ansible.git"
    repo_dest: "/tmp/ME"
    #ansible_sudo_pass: "P@33w0rd"
    
  tasks:
    - name: Clone UEMS Linux Agent from Git
      ansible.builtin.git:
        repo: "{{ repo_url }}"
        dest: "{{ repo_dest }}"
        version: "main"
        force: yes

    - name: Make UEMS_LinuxAgent.bin executable
      ansible.builtin.file:
        path: "{{ repo_dest }}/LinuxAgent/UEMS_LinuxAgent.bin"
        mode: '0755'

    - name: Whoami
      ansible.builtin.command:
        cmd: whoami

    - name: Run the installer
      ansible.builtin.command:
        cmd: sudo ./UEMS_LinuxAgent.bin --silent
        chdir: "{{ repo_dest }}/LinuxAgent/"
      become: yes
      become_user: ASLuser
      ansible_become_pass: "P@ssw0rd"
      become_method: sudo
      
    - name: Remove Folder
      ansible.builtin.file:
        path: "{{ repo_dest }}"
        state: absent
      become: yes
